# 🔥 Resmî Jenkins tabanı (Java + Jenkins hazır)
FROM jenkins/jenkins:lts-jdk17

USER root

# --- Python 3.11 & temel araçlar ---
RUN apt-get update -y && \
    apt-get install -y python3.11 python3.11-venv python3.11-dev python3-pip curl git && \
    ln -sf /usr/bin/python3.11 /usr/bin/python && \
    ln -sf /usr/bin/pip3 /usr/bin/pip && \
    pip install --upgrade pip && \
    pip install poetry==1.8.3

# --- Proje dosyaları ---
WORKDIR /workspace
COPY pyproject.toml poetry.lock* /workspace/

RUN poetry config virtualenvs.create false && \
    poetry install --no-root --no-interaction --no-ansi || true

USER jenkins
